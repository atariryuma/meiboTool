"""pytest 共通フィクスチャ

すべてのテストファイルから自動的にインポートされる。
sys.path ハックは不要（pyproject.toml の pythonpath 設定で解決済み）。
"""

import pandas as pd
import pytest

# ── ダミーデータ ─────────────────────────────────────────────────────────────

@pytest.fixture
def dummy_df() -> pd.DataFrame:
    """テスト用の最小 C4th マッピング済み DataFrame（5名）。"""
    return pd.DataFrame([
        {
            '生徒コード': 'S010001', '学年': '1', '氏名': '山田 太郎',
            '氏名かな': 'やまだ たろう', '正式氏名': '山田 太郎',
            '正式氏名かな': 'やまだ たろう', '性別': '男',
            '生年月日': '2018-06-15',
            '都道府県': '沖縄県', '市区町村': '那覇市', '町番地': '天久1-2-3', '建物名': '',
            '電話番号1': '098-123-4567',
            '保護者名': '山田 幸子', '保護者正式名': '山田 幸子',
            '保護者続柄': '母', '緊急連絡先': '090-1234-5678',
            '組': '1', '出席番号': '1',
        },
        {
            '生徒コード': 'S010002', '学年': '1', '氏名': '田中 花子',
            '氏名かな': 'たなか はなこ', '正式氏名': '田中 花子',
            '正式氏名かな': 'たなか はなこ', '性別': '女',
            '生年月日': '2018-04-03',
            '都道府県': '沖縄県', '市区町村': '那覇市', '町番地': '古島2-3-4', '建物名': 'コーポA101',
            '電話番号1': '098-234-5678',
            '保護者名': '田中 美穂', '保護者正式名': '田中 美穂',
            '保護者続柄': '母', '緊急連絡先': '090-2345-6789',
            '組': '1', '出席番号': '2',
        },
        {
            '生徒コード': 'S010003', '学年': '1', '氏名': '鈴木 健太',
            '氏名かな': 'すずき けんた', '正式氏名': '鈴木 健太',
            '正式氏名かな': 'すずき けんた', '性別': '男',
            '生年月日': '2018-09-20',
            '都道府県': '沖縄県', '市区町村': '那覇市', '町番地': '真地3-4-5', '建物名': '',
            '電話番号1': '098-345-6789',
            '保護者名': '鈴木 典子', '保護者正式名': '鈴木 典子',
            '保護者続柄': '母', '緊急連絡先': '090-3456-7890',
            '組': '1', '出席番号': '3',
        },
        {
            '生徒コード': 'S010004', '学年': '1', '氏名': '佐藤 凛',
            '氏名かな': 'さとう りん', '正式氏名': '佐藤 凛',
            '正式氏名かな': 'さとう りん', '性別': '女',
            '生年月日': '2018-12-01',
            '都道府県': '沖縄県', '市区町村': '那覇市', '町番地': '小禄4-5-6', '建物名': '',
            '電話番号1': '098-456-7890',
            '保護者名': '佐藤 恵子', '保護者正式名': '佐藤 恵子',
            '保護者続柄': '母', '緊急連絡先': '090-4567-8901',
            '組': '1', '出席番号': '4',
        },
        {
            '生徒コード': 'S010005', '学年': '1', '氏名': '高橋 翔',
            '氏名かな': 'たかはし しょう', '正式氏名': '高橋 翔',
            '正式氏名かな': 'たかはし しょう', '性別': '男',
            '生年月日': '2018-02-28',
            '都道府県': '沖縄県', '市区町村': '那覇市', '町番地': '壺川5-6-7', '建物名': '',
            '電話番号1': '098-567-8901',
            '保護者名': '高橋 和子', '保護者正式名': '高橋 和子',
            '保護者続柄': '母', '緊急連絡先': '090-5678-9012',
            '組': '1', '出席番号': '5',
        },
    ])


@pytest.fixture
def default_options() -> dict:
    """テスト用の options 辞書（generator.py の fill_placeholders 等に渡す）。"""
    return {
        'fiscal_year': 2025,
        'school_name': '那覇市立天久小学校',
        'teacher_name': '山田先生',
        'template_dir': '',  # 各テストで上書き
    }


@pytest.fixture
def default_config() -> dict:
    """テスト用の config 辞書。"""
    return {
        'app_version': '1.0.0',
        'school_name': '那覧市立天久小学校',
        'school_type': 'elementary',
        'template_dir': './テンプレート',
        'output_dir': './出力',
        'default_font': 'IPAmj明朝',
        'fiscal_year': 2025,
        'homeroom_teachers': {},
        'update': {
            'version_file_id': '',
            'check_on_startup': False,
            'current_app_version': '1.0.0',
            'current_template_version': '1.0.0',
        },
    }
